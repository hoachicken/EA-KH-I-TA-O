void GetTrendLines(string symbol, ENUM_TIMEFRAMES timeframe, string zzName = "ZigZag", int zzDepth = 12, double zzDeviation = 5.0, ENUM_MA_METHOD zzMethod = MODE_SMA, int zzShift = 0, double& zzHigh[], double& zzLow[]) {
  int zzHandle = iCustom(symbol, timeframe, zzName, zzDepth, zzDeviation, zzShift);
  ArraySetAsSeries(zzHigh, true);
  ArraySetAsSeries(zzLow, true);
  int count = CopyBuffer(zzHandle, 0, 0, zzDepth, zzHigh);
  count = CopyBuffer(zzHandle, 1, 0, zzDepth, zzLow);
}
// EA GTP - Trading Bot Using Autochartist ZingZag Trendlines
// Author: HoaChicken
// Version: 1.0

// Initial variables declaration
input int MagicNumber = 2022;   // Unique identifier for trades
input double Lots = 0.1;        // Trade volume for each trade
input double StopLoss = 50.0;   // Stop Loss value in points
input double TakeProfit = 50.0; // Take Profit value in points
input int Slippage = 3;         // Maximum allowed slippage in points

// Global variables
int ticket = 0;                 // Ticket number of the current trade

// Autochartist ZingZag trendlines settings
input string Symbol = "";       // Symbol used for trading, leave blank to use current chart symbol
input ENUM_TIMEFRAMES Timeframe = PERIOD_H1; // Timeframe used for trendlines
input string ZZName = "ZigZag"; // Name of the ZingZag indicator on the chart
input int ZZDepth = 12;         // ZingZag indicator depth
input double ZZDeviation = 5.0; // ZingZag indicator deviation
input ENUM_MA_METHOD ZZMethod = MODE_SMA; // ZingZag indicator calculation method
input int ZZShift = 0;          // ZingZag indicator shift

int init() {
  return(0);
}

void deinit() {
  // Nothing to do here
}

void OnTick() {
  // Get the trendlines from Autochartist ZingZag indicator
  double ZZHigh[];    // High trendline values
  double ZZLow[];     // Low trendline values
  int ZZCount = 0;    // Number of trendlines detected
  ZZCount = GetTrendLines(Symbol, Timeframe, ZZName, ZZDepth, ZZDeviation, ZZMethod, ZZShift, ZZHigh, ZZLow);
  
  // If trendlines were detected, enter a trade
  if (ZZCount > 0) {
    double currentPrice = SymbolInfoDouble(Symbol(), SYMBOL_BID); // Get the current bid price
    
    // Buy trade
    if (currentPrice > ZZLow[ZZCount-1]) {
      ticket = OrderSend(Symbol(), OP_BUY, Lots, currentPrice, Slippage, currentPrice-StopLoss*Point, currentPrice+TakeProfit*Point, "EA GTP", MagicNumber, 0, Blue);
    }
    
    // Sell trade
    if (currentPrice < ZZHigh[ZZCount-1]) {
      ticket = OrderSend(Symbol(), OP_SELL, Lots, currentPrice, Slippage, currentPrice+StopLoss*Point, currentPrice-TakeProfit*Point, "EA GTP", MagicNumber, 0, Red);
    }
  }
}
